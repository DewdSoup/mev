# =========================
# Helius-only, WS-first live config (free-tier friendly)
# =========================

# --- RPC / Endpoints ---
HELIUS_API_KEY=2bb675f2-573f-4561-b57f-d351db310e5a

# Canonical (keep all for backwards-compat)
RPC_URL=https://mainnet.helius-rpc.com/?api-key=2bb675f2-573f-4561-b57f-d351db310e5a
RPC_PRIMARY=https://mainnet.helius-rpc.com/?api-key=2bb675f2-573f-4561-b57f-d351db310e5a
RPC_WSS_URL=wss://mainnet.helius-rpc.com/?api-key=2bb675f2-573f-4561-b57f-d351db310e5a
PHOENIX_WSS_URL=wss://mainnet.helius-rpc.com/?api-key=2bb675f2-573f-4561-b57f-d351db310e5a
WS_URL=wss://mainnet.helius-rpc.com/?api-key=2bb675f2-573f-4561-b57f-d351db310e5a
WSS_URL=wss://mainnet.helius-rpc.com/?api-key=2bb675f2-573f-4561-b57f-d351db310e5a

# Optional aliases
HELIUS_HTTP=${RPC_URL}
HELIUS_WSS=${RPC_WSS_URL}

# Lock env so config.ts doesn't reload other files after this one
__ENV_LIVE_LOCKED=1

# =========================
# Wallet
# =========================
WALLET_KEYPAIR_PATH=/home/dudesoup/code/mev/wallets/blondi.json
WALLET_PUBKEY=5wqHjxk5VhRTUc9Gavgtan3MN5k31ETjDvnU7x4MPRHr
USDC_ATA=FEcYTKzvgkNDD2VG9SdcvNH1bWYZ2Ggn59XES5y2nAc6
WSOL_ATA=GkvWNym7ctZ3Q6fnB4VuqRV2LDeViygqbtzKRU9Pi4yj
USDC_MINT=EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v
WSOL_MINT=So11111111111111111111111111111111111111112

# =========================
# Markets / Pairs
# =========================
RAYDIUM_POOL_ID=58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2
PHOENIX_MARKET=4DoNfFBfF7UokCC2FQzriy7yHK6DY6NVdYpuekQ5pRgg
RAYDIUM_POOL_JSON_PATH=/home/dudesoup/code/mev/configs/raydium.pool.json
AMMS_RAYDIUM_USE_API_BOOTSTRAP=false
RAYDIUM_POOL_KEYS_JSON=/home/dudesoup/code/mev/configs/raydium.pool.json
PAIRS_JSON=/home/dudesoup/code/mev/configs/pairs.json

# =========================
# Mode / Runners
# =========================
SHADOW_TRADING=0
LIVE_TRADING=1
USE_RPC_SIM=0                 # <— off (avoid extra RPC on decisions)
USE_RAYDIUM_SWAP_SIM=0
ATOMIC_MODE=single_tx
TX_CONFIRM_LEVEL=confirmed
RUN_FOR_MINUTES=

# Use provider (WS snapshots), not file tailers
ENABLE_MARKET_PROVIDER=1
ENABLE_EMBEDDED_PUBLISHERS=1
USE_JSONL_FOLLOWERS=0

# Legacy JSONL paths (kept for compatibility; unused when provider on)
# Resolved by live-runtime.sh so each session keeps logs under its run folder.
# EDGE_AMMS_JSONL=
# EDGE_PHOENIX_JSONL=

# =========================
# Provider (in-process market cache) — WS-first
# =========================
USE_WS_SNAPSHOTS=1
WS_DEBOUNCE_MS=10
WS_RECONNECT_MS=800
WS_MAX_SUBS=64
WS_BACKFILL_ON_GAP=1
WS_KEEPALIVE_HEALTH_MS=60000   # 5 minutes keepalive tick; provider self-heals on disconnect
WS_HEARTBEAT_MS=1000            # 1 second freshener

# Backfill (HTTP) only on gaps; keep it gentle
MARKET_PROVIDER_REFRESH_MS=1200
MARKET_PROVIDER_PHOENIX_REFRESH_MS=2000
MARKET_PROVIDER_REFRESH_DEBOUNCE_MS=300
AMM_REFRESH_DEBOUNCE_MS=300
AMM_BATCH_MAX_ACCOUNTS=64
MARKET_PROVIDER_STALE_MS=5000
MARKET_PROVIDER_PHOENIX_DEPTH=3

# Snapshot staleness guards used by joiner/quoters
BOOK_TTL_MS=1000
AMM_SNAPSHOT_TTL_MS=1000
AMM_SNAPSHOT_MAX_AGE_MS=4000
AMM_SNAPSHOT_FALLBACK_AGE_MS=4000
AMM_SLOT_MAX_LAG=2
ORCA_FORCE_POLL_MS=1200

# =========================
# Decision / sizing / thresholds
# =========================
TRADE_THRESHOLD_BPS=0.3
MIN_NET_PROFIT_BPS=5
MIN_PRICE_DELTA_BPS=1           # Skip re-eval unless PHX/AMM state moved by ≥ this many bps
DECISION_FIXEDCOST_TARGET_BPS=1 # Floor size so fixed cost ≈ this bps of notional when auto-sizing
MAX_SLIPPAGE_BPS=3
PHOENIX_SLIPPAGE_BPS=3
SLIPPAGE_MODE=adaptive
TRADE_SIZE_BASE=0.02
LIVE_SIZE_BASE=0.03
ALLOW_SYNTH_TRADES=false
SIZEOPT_ABS_MAX_BASE=0.048
DECISION_MIN_BASE=0.03
FIXED_PROBE_BASE=0.03

DECISION_DEDUPE_MS=500
DECISION_BUCKET_MS=150
DECISION_MIN_EDGE_DELTA_BPS=0.05
EDGE_MIN_ABS_BPS=0.05
PNL_SAFETY_BPS=.5

# =========================
# Sims / size-opt
# =========================
USE_POOL_IMPACT_SIM=true
CPMM_MAX_POOL_TRADE_FRAC=0.02
DYNAMIC_SLIPPAGE_EXTRA_BPS=0.25
SIZEOPT_MAX_POOL_FRAC=0.02
SIZEOPT_PROBE_STEPS=12

# =========================
# Fees & venue options
# =========================
PHOENIX_TAKER_FEE_BPS=2
AMM_TAKER_FEE_BPS=25
RAYDIUM_TRADE_FEE_BPS=25
ORCA_TRADE_FEE_BPS=30
EV_AMM_FEE_INCLUDED_IN_EFF_PX=1
RAYDIUM_ASSERT_FEE=0
RAYDIUM_MINOUT_BUFFER_BPS=3
PHOENIX_DEPTH_ENABLED=1
PHOENIX_L2_DEPTH=3
PHOENIX_TICK_MS=2000
PHOENIX_WS_ENABLED=1

# =========================
# Costs / submit / tips
# =========================
FIXED_TX_COST_QUOTE=0.0006
AMM_MINOUT_BASE_BPS=2
SUBMIT_MODE=rpc
SUBMIT_CU_LIMIT=800000
TIP_MODE=cu_price
TIP_MULTIPLIER=1.5
TIP_MAX_LAMPORTS=3000000
SUBMIT_TIP_LAMPORTS=0

# Priority fees (raise baseline; executor will auto-bump based on RPC latency)
TIP_MICROLAMPORTS_PER_CU=5000
TIP_MAX_MICROLAMPORTS_PER_CU=100000
SIGNATURE_FEE_LAMPORTS=5000

# Use dynamic EV cost (based on units * μLamports/CU * SOL/USD)
EXEC_USE_DYNAMIC_TX_COST=1
EST_UNITS_BEFORE_SIM=600000    # quick pre-sim guess for the first EV gate

# =========================
# Logging
# =========================
LOG_SIM_FIELDS=1
LOG_RAYDIUM_MINOUT=1
LOG_RAYDIUM_TOKEN_CTOR=0
LOG_RAYDIUM_SWAP_BUILD=1
DECISION_LOG_BOTH=1

# =========================
# Price fallbacks / pool ids
# =========================
PYTH_PRICE_ID_SOL_USDC=0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d
RAYDIUM_POOL_BASE_MINT=So11111111111111111111111111111111111111112
RAYDIUM_POOL_QUOTE_MINT=EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v

# AMM publisher (legacy; unused when provider on)
AMMS_TICK_MS=1500

# =========================
# Proof mode (unchanged)
# =========================
PROOF_FORCE_ONCE=0
PROOF_PATH=
PROOF_SIZE_BASE=0.002
PROOF_BYPASS_EV=0

# Production validation parameters
PRICE_VALIDATION_MAX_SPREAD_BPS=200
MIN_PROFITABLE_BPS=5
MAX_REALISTIC_PROFIT_BPS=100
MIN_POOL_LIQUIDITY_SOL=1000
MIN_POOL_LIQUIDITY_USDC=100000
MAX_DAILY_TRADES=50
MAX_DAILY_VOLUME_QUOTE=10000

# Circuit breakers
CIRCUIT_BREAKER_PRICE_CHANGE_BPS=500
PRICE_STALENESS_MS=10000

# =========================
# Venue toggles / routing
# =========================
ENABLE_AMM_RAYDIUM=1
ENABLE_AMM_ORCA=1
AMMS_ENABLE=raydium,raydium_clmm,orca

RAYDIUM_POOL_ID_SOL_USDC=58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2
ORCA_POOL_ID=HJPjoWUrhoZzkNfRpHuieeFk9WcZWjwy6PBjZ81ngndJ

EXEC_AMM_VENUE=
TRACK_AMM_AMM=1
EXECUTE_AMM_AMM=1

# =========================
# CLMM Quoter / guards
# =========================
CLMM_QUOTER_ENABLED=1
CLMM_QUOTER_RPC_URL=${RPC_URL}
RPC_SIM_TOL_BPS=2
MIN_ORCA_BASE_SIZE=0.000001
CLMM_CONCURRENCY=1
CLMM_RETRY=4
CLMM_BACKOFF_BASE_MS=300
CLMM_BACKOFF_MAX_MS=4000
AMMS_FEE_SOURCE_AUDIT=1
ORCA_QUOTER_EXTRA_BPS=2

# Allow controlled on-chain fallback quoting when snapshots are stale
CLMM_ALLOW_ONCHAIN_FALLBACK=1
CLMM_ONCHAIN_CACHE_TTL_MS=2000

# Enforce snapshot-only quoting (no per-quote RPC)
QUOTER_SNAPSHOT_ONLY=1
DISABLE_QUOTER_RPC_FALLBACK=1

# CLMM cache TTLs (reduce churn)
RAYDIUM_CLMM_POOLINFO_TTL_MS=5000
RAYDIUM_CLMM_TICKARRAY_TTL_MS=3000
CLMM_EPOCH_TTL_MS=15000
CLMM_MINTINFO_TTL_MS=600000

# =========================
# Rate-limit aware RPC backoff (free tier)
# =========================
RPC_BACKOFF_MAX_CONCURRENCY=12
RPC_BACKOFF_MAX_RETRIES=5
RPC_BACKOFF_BASE_MS=400
RPC_BACKOFF_MAX_MS=4000
CLMM_PREFER_ADAPTER=1           # Prefer adapter-backed CLMM quotes (fee+slippage aware)
RATE_LIMIT_BACKOFF_MS=1500      # How long to pause after "rate_limited" from quoters/adapters

# RPC facade tuning (batching/smoothing)
RPC_FACADE_LIMITER=1
RPC_FACADE_RPS=25
RPC_FACADE_BURST=50
RPC_FACADE_BATCH_MAX=128
RPC_FACADE_BATCH_DELAY_MS=2
RPC_FACADE_DEBOUNCE_MS=2
RPC_FACADE_METRICS_MS=10000

# =========================
# Funding gate (safety)
# =========================
FUND_MIN_LAMPORTS=1
FUND_MIN_USDC=0.000001
SEND_WITHOUT_FUNDS=0

# =========================
# Router / execution
# =========================
ROUTER_ALLOW_AMM_PHOENIX=1
ROUTER_ALLOW_PHOENIX_AMM=1
ROUTER_ALLOW_AMM_AMM=1
ROUTER_MAX_HOPS=3
EXEC_JOINER_MODE=single_tx

# Raydium CLMM builder placeholder (stay off until wired)
CLMM_REAL_BUILDER=0
CLMM_CU_LIMIT=1000000
CLMM_CU_PRICE_MICROLAMPORTS=0
JOINER_CONCURRENT_QUOTES=1
ENABLE_RAYDIUM_CLMM=1
